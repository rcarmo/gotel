version: '3.8'

services:
  # Self-contained OpenTelemetry Collector with SQLite storage
  gotel:
    build: .
    ports:
      - "4317:4317"   # OTLP gRPC
      - "4318:4318"   # OTLP HTTP
      - "3200:3200"   # Query API
      - "8888:8888"   # Collector metrics
    environment:
      - GOTEL_DB_PATH=/data/gotel.db
    volumes:
      - gotel-data:/data
    networks:
      - otel-network

  # Web UI with PerfCascade
  web:
    build:
      context: .
      dockerfile: Dockerfile.web
    ports:
      - "3000:3000"   # Web UI
    environment:
      - GOTEL_API_URL=http://gotel:3200
    depends_on:
      - gotel
    networks:
      - otel-network

volumes:
  gotel-data:

networks:
  otel-network:
    driver: bridge
