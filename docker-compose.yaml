version: '3.8'

services:
  # Self-contained OpenTelemetry Collector with SQLite storage
  gotel:
    build: .
    ports:
      - "4317:4317"   # OTLP gRPC
      - "4318:4318"   # OTLP HTTP
      - "3200:3200"   # Query API
      - "8888:8888"   # Collector metrics
    environment:
      - GOTEL_DB_PATH=/data/gotel.db
    volumes:
      - ./gotel.db:/data/gotel.db:Z
    networks:
      - otel-network

  # Web UI with PerfCascade
  web:
    working_dir: /app/web
    command: bun run server.ts
    volumes:
      - .:/app:Z
    ports:
      - "3000:3000"   # Web UI
    depends_on:
      - gotel
    networks:
      - otel-network

networks:
  otel-network:
    driver: bridge
